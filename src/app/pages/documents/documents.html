<div class="container">
  <h2 class="mb-4 fw-bold">Explorar res√∫menes</h2>

  <div class="filter-row">
    <div>
      <label class="form-label mb-1">Universidad:</label>
      <select class="form-select" [(ngModel)]="selectedUniversityId" (change)="onUniversityChange()">
        <option [ngValue]="null">Seleccionar universidad...</option>
        @for (u of allUniversities; track u.id) {
          <option [value]="u.id">{{ u.name }}</option>
        }
      </select>
    </div>

    <div>
      <label class="form-label mb-1">Carrera:</label>
      <select class="form-select" [(ngModel)]="selectedCareerId" (change)="onCareerChange()" [disabled]="!selectedUniversityId">
        <option [ngValue]="null">Seleccionar carrera...</option>
        @for (c of filteredCareers; track c.id) {
          <option [value]="c.id">{{ c.name }}</option>
        }
      </select>
    </div>

    <div>
      <label class="form-label mb-1">Materia:</label>
      <select class="form-select" [(ngModel)]="materia" (change)="filtrar()" [disabled]="!selectedCareerId">
        <option value="">Seleccionar materia...</option>
        @for (m of filteredSubjects; track m.id) {
          <option [value]="m.name">{{ m.name }}</option>
        }
      </select>
    </div>

    <div>
      <label class="form-label mb-1">Nombre del resumen:</label>
      <input class="form-control" placeholder="Ej: Base de datos..." [(ngModel)]="nombre" (input)="filtrar()">
    </div>

    <div>
      <label class="form-label mb-1">Autor:</label>
      <input class="form-control" placeholder="Ej: Juan P√©rez" [(ngModel)]="autor" (input)="filtrar()">
    </div>

    <div>
      <label class="form-label mb-1">Ordenar por:</label>
      <select class="form-select" [(ngModel)]="orden" (change)="cambiarOrden()">
        <option value="recientes">M√°s recientes</option>
        <option value="puntuados">Mejor puntuados</option>
        <option value="descargados">M√°s descargados</option>
      </select>
    </div>
  </div>

  @if (!materia && !nombre && !autor) {
    <p class="no-results">Us√° los filtros para buscar res√∫menes üîç</p>
  } @else if (filtrados.length === 0) {
    <p class="no-results">No se encontraron res√∫menes con los filtros aplicados üîç</p>
  }

  @for (doc of filtrados; track doc.id) {
    <div class="doc-card">
      <a class="doc-card-link" (click)="seleccionarDocumento(doc.id)">
        <strong>{{ doc.title }}</strong>
        <p>{{ doc.description }}</p>
        <div class="doc-card-meta">
          <span class="subject">{{ doc.subject?.name || doc.subject }}</span>
          <span class="download-count">{{ doc.downloadCount || 0 }} descargas</span>
        </div>
      </a>
      <div class="doc-card-author">
        <a [routerLink]="['/user-profile', doc.authorUsername]" class="author-link" (click)="$event.stopPropagation()">
          <span class="author-avatar-sm">{{ (doc.authorUsername || '?').charAt(0).toUpperCase() }}</span>
          {{ doc.authorUsername || 'Autor desconocido' }}
        </a>
      </div>
    </div>
  }
</div>