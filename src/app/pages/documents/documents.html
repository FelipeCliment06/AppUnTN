<div class="container">
  <div class="page-header">
    <h2>Explorar resúmenes</h2>
    <p class="page-subtitle">Buscá y descubrí material compartido por la comunidad</p>
  </div>

  <div class="filter-row">
    <div>
      <label>Universidad</label>
      <select class="form-select" [(ngModel)]="selectedUniversityId" (change)="onUniversityChange()">
        <option [ngValue]="null">Seleccionar universidad...</option>
        @for (u of allUniversities; track u.id) {
          <option [value]="u.id">{{ u.name }}</option>
        }
      </select>
    </div>

    <div>
      <label>Carrera</label>
      <select class="form-select" [(ngModel)]="selectedCareerId" (change)="onCareerChange()" [disabled]="!selectedUniversityId">
        <option [ngValue]="null">Seleccionar carrera...</option>
        @for (c of filteredCareers; track c.id) {
          <option [value]="c.id">{{ c.name }}</option>
        }
      </select>
    </div>

    <div>
      <label>Materia</label>
      <select class="form-select" [(ngModel)]="materia" (change)="filtrar()" [disabled]="!selectedCareerId">
        <option value="">Seleccionar materia...</option>
        @for (m of filteredSubjects; track m.id) {
          <option [value]="m.name">{{ m.name }}</option>
        }
      </select>
    </div>

    <div>
      <label>Nombre del resumen</label>
      <input class="form-control" placeholder="Ej: Base de datos..." [(ngModel)]="nombre" (input)="filtrar()">
    </div>

    <div>
      <label>Autor</label>
      <input class="form-control" placeholder="Ej: Juan Pérez" [(ngModel)]="autor" (input)="filtrar()">
    </div>

    <div>
      <label>Ordenar por</label>
      <select class="form-select" [(ngModel)]="orden" (change)="cambiarOrden()">
        <option value="recientes">Más recientes</option>
        <option value="puntuados">Mejor puntuados</option>
        <option value="descargados">Más descargados</option>
      </select>
    </div>
  </div>

  @if (!materia && !nombre && !autor) {
    <p class="no-results">Usá los filtros para buscar resúmenes</p>
  } @else if (filtrados.length === 0) {
    <p class="no-results">No se encontraron resúmenes con los filtros aplicados</p>
  }

  @for (doc of filtrados; track doc.id) {
    <div class="doc-card">
      <a class="doc-card-link" (click)="seleccionarDocumento(doc.id)">
        <h3 class="doc-card-title">{{ doc.title }}</h3>
        <p class="doc-card-desc">{{ doc.description }}</p>
        <div class="doc-card-meta">
          <span class="badge-subject">{{ doc.subject?.name || doc.subject }}</span>
          <span class="badge-downloads">↓ {{ doc.downloadCount || 0 }} descargas</span>
        </div>
      </a>
      <div class="doc-card-author">
        <a [routerLink]="['/user-profile', doc.authorUsername]" class="author-link" (click)="$event.stopPropagation()">
          <span class="author-avatar-sm">{{ (doc.authorUsername || '?').charAt(0).toUpperCase() }}</span>
          {{ doc.authorUsername || 'Autor desconocido' }}
        </a>
      </div>
    </div>
  }
</div>
