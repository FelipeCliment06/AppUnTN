<div class="contenedor">
  <h2 class="titulo">Gesti√≥n de Usuarios</h2>

  <div class="controles">
    
    <div class="filtros">
      <div class="filtro-grupo">
        <input
          type="text"
          class="filtro-input"
          placeholder="Filtrar por usuario"
          [value]="filtroUsername()"
          (input)="onFiltroChange('username', $event)"
        />

        <input
          type="text"
          class="filtro-input"
          placeholder="Filtrar por nombre"
          [value]="filtroNombre()"
          (input)="onFiltroChange('nombre', $event)"
        />

        <input
          type="text"
          class="filtro-input"
          placeholder="Filtrar por email"
          [value]="filtroEmail()"
          (input)="onFiltroChange('email', $event)"
        />

        <select
        class="filtro-input"
        [value]="filtroRol()"
        (change)="onFiltroChange('rol', $event)"
        >
            <option value="">Todos los roles</option>
            <option value="PROFESSOR">Profesor</option>
            <option value="STUDENT">Alumno</option>
        </select>
      </div>
    </div>
  </div>

  <div class="tabla-wrap">
    <table class="tabla">
      <thead class="tabla-cabecera">
        <tr>
            <th>Usuario</th>
            <th>Nombre Completo</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Acciones</th>
        </tr>
    </thead>

        <tbody class="tabla-cuerpo">
        @for (user of filteredUsers(); track user.username) {
            <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.name }} {{ user.lastname }}</td>
            <td>{{ user.mail }}</td>
            <td>
                <span class="badge" [class.badge-prof]="user.role.includes('PROFESSOR')" [class.badge-stud]="user.role.includes('STUDENT')">
                {{ getRolLegible(user.role) }}
              </span>
            </td>

            <td class="tabla-acciones">
              @if (user.username.toLowerCase() !== usernameActual && user.username.toLowerCase() !== 'admin0') {
                
                <div class="btn-group">
                  @if (user.role.includes('STUDENT')) {
                    <button class="btn-cambio prof" (click)="changeRole(user, 'PROFESSOR')">
                      Hacer Profesor
                    </button>
                  } @else {
                    <button class="btn-cambio stud" (click)="changeRole(user, 'STUDENT')">
                      Hacer Alumno
                    </button>
                  }

                  <button class="btn-eliminar" (click)="deleteUser(user.username)">
                    Eliminar
                  </button>
                </div>

              } @else {
                <span class="accion-nodisp">Sistema</span>
              }
            </td>
          </tr>
        } @empty {
          <tr><td colspan="5" class="tabla-vacia">No se encontraron usuarios.</td></tr>
        }
      </tbody>
    </table>
  </div>

  <div class="volver-area">
    <button class="btn-volver" (click)="volverPerfil()">
      Volver al perfil
    </button>
  </div>
</div>