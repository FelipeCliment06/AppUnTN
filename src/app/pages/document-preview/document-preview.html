<div class="container">
  <h2 class="mb-4">Vista previa del resumen</h2>

  @if (document) {

    <!-- Info del documento -->
    <div class="document-card">
      <div>
        <h3>{{document.title}}</h3>
        <p><strong>Descripci√≥n:</strong> {{document.description}}</p>
        <p><strong>Materia:</strong> {{document.subject}}</p>
        <p><strong>Autor:</strong> {{document.authorUsername}}</p>
        <p><strong>Fecha de subida:</strong> {{document.uploadDate}}</p>
      </div>

      <button class="btn btn-success mb-4" (click)="descargarResumen()">Descargar</button>
      @if (isAdmin) {
        <button class="btn btn-outline-danger" (click)="eliminarResumenCompleto()">
          üóëÔ∏è Eliminar Resumen
        </button>
      }
    </div>

    <!-- Puntuaciones -->
    <div class="mb-5">
      <h4>Puntuaciones</h4>
      
      <!-- Lista scrolleable de puntuaciones -->
      <div class="puntuaciones-container">
        <ul class="list-group mb-3">
          @for (p of puntuaciones; track p.id) {
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <strong>{{p.authorUsername}}</strong>: 
                <!-- Mostrar estrellas seg√∫n el valor de la puntuaci√≥n -->
                @for (starNum of [1,2,3,4,5]; track starNum) {
                  <span class="star-display" [class.filled]="starNum <= p.value">‚òÖ</span>
                }
                @if (p.destacado) {
                  <span class="star-destacada">‚≠ê</span>
                }
              </span>
              <div>
                @if (p.authorUsername === username) {
                  <button class="btn btn-danger btn-sm" (click)="eliminarPuntuacion(p.id)">Eliminar</button>
                }
              </div>
            </li>
          }
        </ul>
      </div>

      <!-- Selecci√≥n de estrellas (fuera del scroll) -->
      <div class="mb-3">
        <label class="form-label">Tu puntuaci√≥n:</label><br />
        @for (i of estrellas; track i) {
          <span class="star" [class.selected]="puntuacionSeleccionada() >= i" (click)="selectStar(i)">‚òÖ</span>
        }
        <button class="btn btn-primary btn-sm ms-2" (click)="enviarPuntuacion()">Enviar</button>
      </div>
    </div>

    <!-- Comentarios -->
    <div class="mb-5">
      <h4>Comentarios</h4>
      
      <!-- Lista scrolleable de comentarios -->
      <div class="comentarios-container">
        <ul class="list-group mb-3">
          @for (c of comentarios; track $index) {
            <li class="list-group-item d-flex justify-content-between align-items-start" [ngClass]="{'comment-destacado': c.destacado}">
              <div>
                <strong>{{c.authorUsername}}</strong> ({{c.creationDate}}):<br />{{c.content}}
              </div>
              <div>
                @if (c.authorUsername === username) {
                  <button class="btn btn-danger btn-sm ms-2" (click)="eliminarComentario(c.id)">Eliminar</button>
                } 
                @else if (isAdmin) {
                  <button class="btn btn-dark btn-sm ms-2" (click)="eliminarComentario(c.id)">Moderar</button>
                }
              </div>
            </li>
          }
        </ul>
      </div>

      <!-- Nuevo comentario (fuera del scroll) -->
      <div class="mb-3">
        <div>
          <label for="comentario" class="form-label">Agregar comentario:</label>
        </div>
        <textarea class="form-control" id="comentario" name="comentario" rows="3" [(ngModel)]="nuevoComentario"></textarea>
      </div>
      <button class="btn btn-primary" (click)="enviarComentario()">Comentar</button>
    </div>
  }
</div>